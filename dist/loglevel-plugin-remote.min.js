!function(e,t){if("function"==typeof define&&define.amd)define(["module","exports"],t);else if("undefined"!=typeof exports)t(module,exports);else{var n={exports:{}};t(n,n.exports),e.remote=n.exports}}(this,function(e,t){"use strict";function n(e){try{return JSON.stringify(e)}catch(e){if(!f)try{var t={};t.a=t,JSON.stringify(t)}catch(e){f=e.message}if(e.message===f)return"[Circular]";throw e}}function r(e){if(!Object.getOwnPropertyDescriptor||!Object.getPrototypeOf)return Object.prototype.toString.call(e).slice(8,-1);for(;e;){var t=Object.getOwnPropertyDescriptor(e,"constructor");if(void 0!==t&&"function"==typeof t.value&&""!==t.value.name)return t.value.name;e=Object.getPrototypeOf(e)}return""}function o(e){var t="",o=0;return e.length>1&&"string"==typeof e[0]&&(t=(t=e[0].replace(/(%?)(%([sdjo]))/g,function(t,i,a,c){if(!i){var s=e[o+=1],u="";switch(c){case"s":u+=s;break;case"d":u+=+s;break;case"j":u=n(s);break;case"o":var l=n(s);"{"!==l[0]&&"["!==l[0]&&(l="<"+l+">"),u=r(s)+l}return u}return t})).replace(/%{2,2}/g,"%"),o+=1),e.length>o&&(t&&(t+=" "),t+=e.slice(o).join(" ")),t}function i(){for(var e={},t=0;t<arguments.length;t+=1){var n=Object(arguments[t]);for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]="object"!==l(n[r])||Array.isArray(n[r])?n[r]:i(e[r],n[r]))}return e}function a(){try{throw new Error}catch(e){return e.stack}}function c(e){var t=this,n=[],r=[];this.length=function(){return n.length},this.sent=function(){return r.length},this.push=function(t){n.push(t),n.length>e&&n.shift()},this.send=function(){return r.length||(r=n,n=[]),r},this.confirm=function(){r=[],t.content=""},this.fail=function(){var o=1+n.length+r.length-e;o>0&&(r.splice(0,o),n=r.concat(n),t.confirm())}}function s(){return{json:!1,formatter:function(e){return"["+e.timestamp+"] "+(e.logger?"("+e.logger+") ":"")+e.level.label.toUpperCase()+": "+e.message+(e.stacktrace?"\n"+e.stacktrace:"")}}}function u(){throw new Error("You can't set token for a not appled plugin")}Object.defineProperty(t,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=void 0,p=!!a(),g=void 0,v=void 0,d=void 0,m=window?window.remote:void 0,h={url:"/logger",token:"",timeout:0,interval:1e3,backoff:function(e){var t=2*e;return t>3e4&&(t=3e4),t+=.1*t*Math.random()},capacity:0,stacktrace:{levels:["trace","warn","error"],depth:3,excess:0},timestamp:function(){return(new Date).toISOString()},format:s},remote={noConflict:function(){return window&&window.remote===remote&&(window.remote=m),remote},plain:s,json:function(){return{json:!0,formatter:function(e){return e.level=e.level.label,e}}},apply:function(e,t){function n(){function e(e){var t=y;e||(y=r.backoff(y),w.fail()),t?(m=!0,setTimeout(function(){m=!1,n()},t)):n()}if(!m&&!f&&void 0!==r.token){if(!w.sent()){if(!w.length())return;var t=w.send();w.content=s.json?'{"logs":['+t.join(",")+"]}":t.join("\n")}f=!0;var o=new window.XMLHttpRequest;o.open("POST",r.url,!0),o.setRequestHeader("Content-Type",l),r.token&&o.setRequestHeader("Authorization",u);var i=void 0;r.timeout&&(i=setTimeout(function(){f=!1,o.abort(),e()},r.timeout)),o.onreadystatechange=function(){4===o.readyState&&(f=!1,clearTimeout(i),200===o.status?(y=r.interval,w.confirm(),e(!0)):(401===o.status&&(r.token=void 0,g.getLogger("logger").error("Authorization Failed")),e()))},o.send(w.content)}}if(!e||!e.getLogger)throw new TypeError("Argument is not a root loglevel object");if(g)throw new Error("You can assign a plugin only one time");if(!window||!window.XMLHttpRequest)return e;g=e;var r=i(h,t),s=r.format(),u="Bearer "+r.token,l=s.json?"application/json":"text/plain";r.capacity||(r.capacity=500);var f=!1,m=!1,y=r.interval,w=new c(r.capacity);return v=e.methodFactory,d=function(e,t,i){var c=v(e,t,i),u=p&&r.stacktrace.levels.some(function(t){return t===e}),l=g.levels[e.toUpperCase()];return function(){for(var t=arguments.length,f=Array(t),p=0;p<t;p++)f[p]=arguments[p];var v=r.timestamp(),d=u?a():"";if(d){var m=d.split("\n");m.splice(0,r.stacktrace.excess+3);var h=r.stacktrace.depth;h&&m.length!==h+1?(d=m.splice(0,h).join("\n"),m.length&&(d+="\n    and "+m.length+" more")):d=m.join("\n")}var y={message:o(f),level:{label:e,value:l},logger:i||"",timestamp:v,stacktrace:d},b="";if(s.json)try{b+=JSON.stringify(s.formatter(y))}catch(e){return c.apply(void 0,f),void g.getLogger("logger").error(e)}else b+=s.formatter(y);w.push(b),n(),c.apply(void 0,f)}},e.methodFactory=d,e.setLevel(e.getLevel()),remote.setToken=function(e){r.token=e,u="Bearer "+e,n()},e},disable:function(){if(!g)throw new Error("You can't disable a not appled plugin");if(d!==g.methodFactory)throw new Error("You can't disable a plugin after appling another plugin");g.methodFactory=v,g.setLevel(g.getLevel()),g=void 0,remote.setToken=u},setToken:u};t.default=remote,e.exports=t.default});