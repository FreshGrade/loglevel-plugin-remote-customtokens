!function(t,e){if("function"==typeof define&&define.amd)define(["module","exports"],e);else if("undefined"!=typeof exports)e(module,exports);else{var n={exports:{}};e(n,n.exports),t.remote=n.exports}}(this,function(t,e){"use strict";function n(t){try{return JSON.stringify(t)}catch(t){if(!l)try{var e={};e.a=e,JSON.stringify(e)}catch(t){l=t.message}if(t.message===l)return"[Circular]";throw t}}function r(t){if(!Object.getOwnPropertyDescriptor||!Object.getPrototypeOf)return Object.prototype.toString.call(t).slice(8,-1);for(;t;){var e=Object.getOwnPropertyDescriptor(t,"constructor");if(void 0!==e&&"function"==typeof e.value&&""!==e.value.name)return e.value.name;t=Object.getPrototypeOf(t)}return""}function o(t){var e="",o=0;return t.length>1&&"string"==typeof t[0]&&(e=(e=t[0].replace(/(%?)(%([sdjo]))/g,function(e,i,a,s){if(!i){var c=t[o+=1],u="";switch(s){case"s":u+=c;break;case"d":u+=+c;break;case"j":u=n(c);break;case"o":var f=n(c);"{"!==f[0]&&"["!==f[0]&&(f="<"+f+">"),u=r(c)+f}return u}return e})).replace(/%{2,2}/g,"%"),o+=1),t.length>o&&(e&&(e+=" "),e+=t.slice(o).join(" ")),e}function i(){for(var t={},e=0;e<arguments.length;e+=1){var n=Object(arguments[e]);for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]="object"!==u(n[r])||Array.isArray(n[r])?n[r]:i(t[r],n[r]))}return t}function a(){try{throw new Error}catch(t){return t.stack}}function s(t,e){var n=this,r=[],o=[];this.length=function(){return r.length},this.sent=function(){return o.length},this.push=function(n){r.push(n[0]),e&&r.length>t&&r.shift()},this.send=function(){return o.length||(o=r,r=[]),o},this.confirm=function(){o=[],n.content=""},this.fail=function(){var e=1+r.length+o.length-t;e>0&&(o.splice(0,e),r=o.concat(r),n.confirm())}}function c(t,e){var n=this,r=window?window.localStorage:void 0,o={length:function(){return 0},confirm:function(){}};if(!r)return o;var i=void 0,a=void 0,s=void 0;try{i=r.getItem.bind(r),a=r.setItem.bind(r),s=r.removeItem.bind(r);var c=f+"-test";a(c,c),s(c)}catch(t){return o}var u=f+"-queue",l=f+"-sent",p=[],h=[],g=function(n){for(var r=(n=n||p)===p?u:l;;){var o=e?"["+n.join(",")+"]":JSON.stringify(n);if(o.length<512*t)try{a(r,o);break}catch(t){if(!n.length){s(r);break}}n.shift()}},v=i(l);v&&(p=JSON.parse(v),s(l));var d=i(u);d&&(p=p.concat(JSON.parse(d))),p.length&&"string"!=typeof p[0]&&(p=p.map(function(t){return JSON.stringify(t)})),g(),this.length=function(){return p.length},this.sent=function(){return p.sent},this.push=function(t){t.length&&(p=p.concat(t),g())},this.send=function(){return h.length||(h=p,p=[],g(),g(h)),h},this.confirm=function(){h=[],n.content="",s(l)},this.fail=function(){p=h.concat(p),n.confirm(),g()},this.unshift=function(t){t.length&&(p=t.concat(p),g())}}Object.defineProperty(e,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f="loglevel-plugin-remote",l=void 0,p=500,h=50,g={url:"/logger",token:"",timeout:0,interval:1e3,backoff:function(t){var e=2*t;return e>3e4&&(e=3e4),e+=.1*e*Math.random()},persist:"default",capacity:0,stacktrace:{levels:["trace","warn","error"],depth:3,excess:0},json:!1,timestamp:function(){return(new Date).toISOString()},handle:"remote"},v=!!a(),d=void 0,y=void 0,m=void 0,w=window?window.remote:void 0,remote={apply:function(t,e){function n(){function t(t){var r=j;t||(j=e.backoff(j),k.fail(),"never"!==e.persist&&O!==f&&(f.push(l.send()),l.confirm(),f.push(l.send()),l.confirm(),O=f)),r?(b=!0,setTimeout(function(){b=!1,n()},r)):n()}if(!b&&!w&&void 0!==e.token){if(!k.sent()){if(f.length())k=f;else{if(!l.length())return;k=l}var o=k.send();k.content=e.json?'{"messages":['+o.join(",")+"]}":o.join("\n")}w=!0;var i=new window.XMLHttpRequest;i.open("POST",e.url,!0),i.setRequestHeader("Content-Type",u),e.token&&i.setRequestHeader("Authorization",r);var a=void 0;e.timeout&&(a=setTimeout(function(){w=!1,i.abort(),t()},e.timeout)),i.onreadystatechange=function(){4===i.readyState&&(w=!1,clearTimeout(a),200===i.status?(j=e.interval,k.confirm(),"always"!==e.persist&&(O=l),t(!0)):t())},i.send(k.content)}}if(!t||!t.getLogger)throw new TypeError("Argument is not a root loglevel object");if(d)throw new Error("You can assign a plugin only one time");if(!window||!window.XMLHttpRequest)return t;d=t;var r="Bearer "+(e=i(g,e)).token,u=e.json?"application/json":"text/plain";e.capacity||(e.capacity="never"===e.persist?p:h);var f=new c(e.capacity,e.json);f.push||"never"===e.persist||(e.persist="never",e.capacity=p);var l=new s(e.capacity,"never"===e.persist),w=!1,b=!1,j=e.interval,O="always"===e.persist?f:l,k=O;return y=t.methodFactory,m=function(t,r,i){var s=y(t,r,i),c=v&&e.stacktrace.levels.some(function(e){return e===t});return function(){for(var r=arguments.length,u=Array(r),f=0;f<r;f++)u[f]=arguments[f];var l=e.timestamp(),p=c?a():"";if(p){var h=p.split("\n");h.splice(0,e.stacktrace.excess+3);var g=e.stacktrace.depth;g&&h.length!==g+1?(p=h.splice(0,g).join("\n"),h.length&&(p+="\n    and "+h.length+" more")):p=h.join("\n")}var v={message:o(u),level:t,logger:i||"",timestamp:l,stacktrace:p},d=e.json?JSON.stringify(v):v.message+(v.stacktrace?"\n"+v.stacktrace:"");O.push([d]),n(),s.apply(void 0,u)}},t.methodFactory=m,t.setLevel(t.getLevel()),t.plugins||(t.plugins={}),t.plugins[e.handle]={setToken:function(t){e.token=t,r="Bearer "+t,n()},disable:function(){if(m!==d.methodFactory)throw new Error("You can't disable a plugin after appling another plugin");d.methodFactory=y,d.setLevel(d.getLevel()),d=void 0,delete t.plugins[e.handle]}},t},noConflict:function(){return window&&window.remote===remote&&(window.remote=w),remote}};e.default=remote,t.exports=e.default});