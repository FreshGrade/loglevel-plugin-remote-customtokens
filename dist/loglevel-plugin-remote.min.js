!function(e,t){if("function"==typeof define&&define.amd)define(["module","exports"],t);else if("undefined"!=typeof exports)t(module,exports);else{var r={exports:{}};t(r,r.exports),e.remote=r.exports}}(this,function(e,t){"use strict";function r(e){try{return JSON.stringify(e)}catch(e){if(!p)try{var t={};t.a=t,JSON.stringify(t)}catch(e){p=e.message}if(e.message===p)return"[Circular]";throw e}}function n(e){if(!Object.getOwnPropertyDescriptor||!Object.getPrototypeOf)return Object.prototype.toString.call(e).slice(8,-1);for(;e;){var t=Object.getOwnPropertyDescriptor(e,"constructor");if(void 0!==t&&"function"==typeof t.value&&""!==t.value.name)return t.value.name;e=Object.getPrototypeOf(e)}return""}function o(e){var t="",o=0;return e.length>1&&"string"==typeof e[0]&&(t=(t=e[0].replace(/(%?)(%([sdjo]))/g,function(t,i,a,c){if(!i){var s=e[o+=1],u="";switch(c){case"s":u+=s;break;case"d":u+=+s;break;case"j":u=r(s);break;case"o":var l=r(s);"{"!==l[0]&&"["!==l[0]&&(l="<"+l+">"),u=n(s)+l}return u}return t})).replace(/%{2,2}/g,"%"),o+=1),e.length>o&&(t&&(t+=" "),t+=e.slice(o).join(" ")),t}function i(){for(var e={},t=0;t<arguments.length;t+=1){var r=Object(arguments[t]);for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]="object"!==l(r[n])||Array.isArray(r[n])?r[n]:i(e[n],r[n]))}return e}function a(){try{throw new Error}catch(e){return e.stack}}function c(e){var t=this,r=[],n=[];this.length=function(){return r.length},this.sent=function(){return n.length},this.push=function(t){r.push(t),r.length>e&&r.shift()},this.send=function(){return n.length||(n=r,r=[]),n},this.confirm=function(){n=[],t.content=""},this.fail=function(){var o=1+r.length+n.length-e;o>0&&(n.splice(0,o),r=n.concat(r),t.confirm())}}function s(e){return"["+e.timestamp+"] "+e.level.label.toUpperCase()+(e.logger?" ("+e.logger+")":"")+": "+e.message+(e.stacktrace?"\n"+e.stacktrace:"")}function u(){throw new Error("You can't set token for a not appled plugin")}Object.defineProperty(t,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=window;if(!f)throw new Error("Plugin for browser usage only");var p=void 0,g=!!a(),v=void 0,d=void 0,h=void 0,y=f.remote,m={url:"/logger",token:"",onUnauthorized:function(){},timeout:0,interval:1e3,backoff:function(e){var t=2*e;return t>3e4&&(t=3e4),t+=.1*t*Math.random()},capacity:0,stacktrace:{levels:["trace","warn","error"],depth:3,excess:0},timestamp:function(){return(new Date).toISOString()},format:s,customHeaders:{}},remote={noConflict:function(){return f.remote===remote&&(f.remote=y),remote},plain:s,json:function(e){return e.level=e.level.label,e},apply:function(e,t){function r(){function e(e){e||(y=n.backoff(y||1),b.fail()),p=!0,f.setTimeout(function(){p=!1,r()},y)}if(!p&&!l&&void 0!==n.token){if(!b.sent()){if(!b.length())return;var t=b.send();b.content=u?'{"logs":['+t.join(",")+"]}":t.join("\n")}l=!0;var o=new f.XMLHttpRequest;o.open("POST",n.url,!0),o.setRequestHeader("Content-Type",s),n.token&&o.setRequestHeader("Authorization","Bearer "+n.token),Object.keys(n.customHeaders).length>0&&Object.keys(n.customHeaders).forEach(function(e){var t=n.customHeaders[e];t&&o.setRequestHeader(e,t)});var i=void 0;n.timeout&&(i=f.setTimeout(function(){l=!1,o.abort(),e()},n.timeout)),o.onreadystatechange=function(){if(4===o.readyState)if(l=!1,f.clearTimeout(i),200===o.status)y=n.interval,b.confirm(),e(!0);else{if(401===o.status){var t=n.token;n.token=void 0,n.onUnauthorized(t)}e()}},o.send(b.content)}}if(!e||!e.getLogger)throw new TypeError("Argument is not a root loglevel object");if(v)throw new Error("You can assign a plugin only one time");if(!f.XMLHttpRequest)return e;v=e;var n=i(m,t),s=void 0,u=void 0;n.capacity||(n.capacity=500);var l=!1,p=!1,y=n.interval,b=new c(n.capacity);return d=e.methodFactory,h=function(e,t,i){var c=d(e,t,i),l=g&&n.stacktrace.levels.some(function(t){return t===e}),f=v.levels[e.toUpperCase()];return function(){for(var t=arguments.length,p=Array(t),g=0;g<t;g++)p[g]=arguments[g];var d=n.timestamp(),h=l?a():"";if(h){var y=h.split("\n");y.splice(0,n.stacktrace.excess+3);var m=n.stacktrace.depth;m&&y.length!==m+1?(h=y.splice(0,m).join("\n"),y.length&&(h+="\n    and "+y.length+" more")):h=y.join("\n")}var k=n.format({message:o(p),level:{label:e,value:f},logger:i||"",timestamp:d,stacktrace:h});void 0===u&&(s=(u="string"!=typeof k)?"application/json":"text/plain");var w="";if(u)try{w+=JSON.stringify(k)}catch(e){return c.apply(void 0,p),void v.getLogger("logger").error(e)}else w+=k;b.push(w),r(),c.apply(void 0,p)}},e.methodFactory=h,e.setLevel(e.getLevel()),remote.setToken=function(e){n.token=e,r()},e},disable:function(){if(!v)throw new Error("You can't disable a not appled plugin");if(h!==v.methodFactory)throw new Error("You can't disable a plugin after appling another plugin");v.methodFactory=d,v.setLevel(v.getLevel()),v=void 0,remote.setToken=u},setToken:u};t.default=remote,e.exports=t.default});