!function(e,t){if("function"==typeof define&&define.amd)define(["module","exports"],t);else if("undefined"!=typeof exports)t(module,exports);else{var r={exports:{}};t(r,r.exports),e.remote=r.exports}}(this,function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=window;if(!u)throw new Error("Plugin for browser usage only");var r=void 0;function l(e){try{return JSON.stringify(e)}catch(e){if(!r)try{var t={};t.a=t,JSON.stringify(t)}catch(e){r=e.message}if(e.message===r)return"[Circular]";throw e}}function b(c){var e="",s=0;return 1<c.length&&"string"==typeof c[0]&&(e=(e=c[0].replace(/(%?)(%([sdjo]))/g,function(e,t,r,n){if(!t){var o=c[s+=1],a="";switch(n){case"s":a+=o;break;case"d":a+=+o;break;case"j":a=l(o);break;case"o":var i=l(o);"{"!==i[0]&&"["!==i[0]&&(i="<"+i+">"),a=function(e){if(!Object.getOwnPropertyDescriptor||!Object.getPrototypeOf)return Object.prototype.toString.call(e).slice(8,-1);for(;e;){var t=Object.getOwnPropertyDescriptor(e,"constructor");if(void 0!==t&&"function"==typeof t.value&&""!==t.value.name)return t.value.name;e=Object.getPrototypeOf(e)}return""}(o)+i}return a}return e})).replace(/%{2,2}/g,"%"),s+=1),c.length>s&&(e&&(e+=" "),e+=c.slice(s).join(" ")),e}var f=Object.prototype.hasOwnProperty;function w(){try{throw new Error}catch(e){return e.stack}}function n(t){var r=this,n=[],o=[];this.length=function(){return n.length},this.sent=function(){return o.length},this.push=function(e){n.push(e),n.length>t&&n.shift()},this.send=function(){return o.length||(o=n,n=[]),o},this.confirm=function(){o=[],r.content=""},this.fail=function(){var e=1+n.length+o.length-t;0<e&&(o.splice(0,e),n=o.concat(n),r.confirm())}}var o=!!w(),k=void 0,i=void 0,p=void 0;function c(e){return"["+e.timestamp+"] "+e.level.label.toUpperCase()+(e.logger?" ("+e.logger+")":"")+": "+e.message+(e.stacktrace?"\n"+e.stacktrace:"")}function s(){throw new Error("You can't set token for a not appled plugin")}var v=u.remote,j={url:"/logger",method:"POST",headers:{},token:"",onUnauthorized:function(){},timeout:0,interval:1e3,backoff:function(e){var t=2*e;return 3e4<t&&(t=3e4),t+=.1*t*Math.random()},capacity:0,stacktrace:{levels:["trace","warn","error"],depth:3,excess:0},timestamp:function(){return(new Date).toISOString()},format:c},remote={noConflict:function(){return u.remote===remote&&(u.remote=v),remote},plain:c,json:function(e){return e.level=e.level.label,e},apply:function(e,t){if(!e||!e.getLogger)throw new TypeError("Argument is not a root loglevel object");if(k)throw new Error("You can assign a plugin only one time");if(!u.XMLHttpRequest)return e;k=e;var g=function e(){for(var t={},r=0;r<arguments.length;r+=1){var n=Object(arguments[r]);for(var o in n)f.call(n,o)&&(t[o]="object"!==a(n[o])||Array.isArray(n[o])?n[o]:e(t[o],n[o]))}return t}(j,t),d=void 0,h=void 0;g.capacity=g.capacity||500;var c=!1,s=!1,l=g.interval,y=new n(g.capacity);function m(){if(!s&&!c&&void 0!==g.token){if(!y.sent()){if(!y.length())return;var e=y.send();y.content=h?'{"logs":['+e.join(",")+"]}":e.join("\n")}c=!0;var t=new u.XMLHttpRequest;t.open(g.method,g.url,!0),t.setRequestHeader("Content-Type",d),g.token&&t.setRequestHeader("Authorization","Bearer "+g.token);var r=g.headers;for(var n in r)if(f.call(r,n)){var o=r[n];o&&t.setRequestHeader(n,o)}var a=void 0;g.timeout&&(a=u.setTimeout(function(){c=!1,t.abort(),i()},g.timeout)),t.onreadystatechange=function(){if(4===t.readyState)if(c=!1,u.clearTimeout(a),200===t.status)l=g.interval,y.confirm(),i(!0);else{if(401===t.status){var e=g.token;g.token=void 0,g.onUnauthorized(e)}i()}},t.send(y.content)}function i(e){e||(l=g.backoff(l||1),y.fail()),s=!0,u.setTimeout(function(){s=!1,m()},l)}}return i=e.methodFactory,p=function(l,e,u){var f=i(l,e,u),p=o&&g.stacktrace.levels.some(function(e){return e===l}),v=k.levels[l.toUpperCase()];return function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=g.timestamp(),o=p?w():"";if(o){var a=o.split("\n");a.splice(0,g.stacktrace.excess+3);var i=g.stacktrace.depth;if(i&&a.length!==i+1)o=a.splice(0,i).join("\n"),a.length&&(o+="\n    and "+a.length+" more");else o=a.join("\n")}var c=g.format({message:b(t),level:{label:l,value:v},logger:u||"",timestamp:n,stacktrace:o});void 0===h&&(d=(h="string"!=typeof c)?"application/json":"text/plain");var s="";if(h)try{s+=JSON.stringify(c)}catch(e){return f.apply(void 0,t),void k.getLogger("logger").error(e)}else s+=c;y.push(s),m(),f.apply(void 0,t)}},e.methodFactory=p,e.setLevel(e.getLevel()),remote.setToken=function(e){g.token=e,m()},e},disable:function(){if(!k)throw new Error("You can't disable a not appled plugin");if(p!==k.methodFactory)throw new Error("You can't disable a plugin after appling another plugin");k.methodFactory=i,k.setLevel(k.getLevel()),k=void 0,remote.setToken=s},setToken:s};t.default=remote,e.exports=t.default});