!function(t,e){if("function"==typeof define&&define.amd)define(["module","exports"],e);else if("undefined"!=typeof exports)e(module,exports);else{var n={exports:{}};e(n,n.exports),t.remote=n.exports}}(this,function(t,e){"use strict";function n(t){try{return JSON.stringify(t)}catch(t){if(!f)try{var e={};e.a=e,JSON.stringify(e)}catch(t){f=t.message}if(t.message===f)return"[Circular]";throw t}}function r(t){if(!Object.getOwnPropertyDescriptor||!Object.getPrototypeOf)return Object.prototype.toString.call(t).slice(8,-1);for(;t;){var e=Object.getOwnPropertyDescriptor(t,"constructor");if(void 0!==e&&"function"==typeof e.value&&""!==e.value.name)return e.value.name;t=Object.getPrototypeOf(t)}return""}function o(t){var e="",o=0;return t.length>1&&"string"==typeof t[0]&&(e=(e=t[0].replace(/(%?)(%([sdjo]))/g,function(e,i,a,c){if(!i){var s=t[o+=1],u="";switch(c){case"s":u+=s;break;case"d":u+=+s;break;case"j":u=n(s);break;case"o":var f=n(s);"{"!==f[0]&&"["!==f[0]&&(f="<"+f+">"),u=r(s)+f}return u}return e})).replace(/%{2,2}/g,"%"),o+=1),t.length>o&&(e&&(e+=" "),e+=t.slice(o).join(" ")),e}function i(){for(var t={},e=0;e<arguments.length;e+=1){var n=Object(arguments[e]);for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}function a(){try{throw new Error}catch(t){return t.stack}}function c(t,e){var n=this,r=[],o=[];this.length=function(){return r.length},this.sent=function(){return o.length},this.push=function(n){r.push(n[0]),e&&r.length>t&&r.shift()},this.send=function(){return o.length||(o=r,r=[]),o},this.confirm=function(){o=[],n.content=""},this.fail=function(){var e=1+r.length+o.length-t;e>0&&(o.splice(0,e),r=o.concat(r),n.confirm())}}function s(t){var e=this,n=window?window.localStorage:void 0,r={length:function(){return 0},confirm:function(){}};if(!n)return r;var o=void 0,i=void 0,a=void 0;try{o=n.getItem.bind(n),i=n.setItem.bind(n),a=n.removeItem.bind(n);var c=u+"-test";i(c,c),a(c)}catch(t){return r}var s=u+"-queue",f=u+"-sent",l=[],p=[],h=function(){for(;;){var e=JSON.stringify(l);if(e.length<512*t)try{i(s,e);break}catch(t){}l.shift()}},v=o(f);v&&(l=JSON.parse(v),a(f));var d=o(s);d&&(l=l.concat(JSON.parse(d))),h(),this.length=function(){return l.length},this.sent=function(){return l.sent},this.push=function(t){t.length&&(l=l.concat(t),h())},this.send=function(){return p.length||(p=l,i(f,JSON.stringify(p)),l=[],h()),p},this.confirm=function(){p=[],e.content="",a(f)},this.fail=function(){l=p.concat(l),h(),e.confirm()},this.unshift=function(t){t.length&&(l=t.concat(l),h())}}Object.defineProperty(e,"__esModule",{value:!0});var u="loglevel-plugin-remote",f=void 0,l=500,p=50,h={url:"/logger",token:"",timeout:0,interval:1e3,backoff:function(t){var e=2*t;return e>3e4&&(e=3e4),e+=.1*e*Math.random()},persist:"default",capacity:0,trace:["trace","warn","error"],depth:0,json:!1,timestamp:function(){return(new Date).toISOString()}},v=!!a(),d=void 0,g=void 0,m=void 0,remote={apply:function(t,e){function r(){function t(t){var n=j;t||(j=e.backoff(j),S.fail(),"never"!==e.persist&&k!==w&&(w.push(y.send()),y.confirm(),w.push(y.send()),y.confirm(),k=w)),n?(O=!0,setTimeout(function(){O=!1,r()},n)):r()}if(!O&&!b){if(!S.sent()){if(w.length())S=w;else{if(!y.length())return;S=y}var o=S.send();if(e.json)S.content=n({messages:o});else{var i="";S.content="",o.forEach(function(t){var e=t.stacktrace?"\n"+t.stacktrace:"";S.content+=""+i+t.message+e,i="\n"})}}b=!0;var a=new window.XMLHttpRequest;a.open("POST",e.url,!0),a.setRequestHeader("Content-Type",f),e.token&&a.setRequestHeader("Authorization",u);var c=void 0;e.timeout&&(c=setTimeout(function(){b=!1,a.abort(),t()},e.timeout)),a.onreadystatechange=function(){4===a.readyState&&(b=!1,clearTimeout(c),200===a.status?(j=e.interval,S.confirm(),"always"!==e.persist&&(k=y),t(!0)):t())},a.send(S.content)}}if(!t||!t.getLogger)throw new TypeError("Argument is not a root loglevel object");if(d)throw new Error("You can assign a plugin only one time");if(!window||!window.XMLHttpRequest)return t;d=t;var u="Bearer "+(e=i(h,e)).token,f=e.json?"application/json":"text/plain";e.capacity||(e.capacity="never"===e.persist?l:p);var w=new s(e.capacity);w.push||"never"===e.persist||(e.persist="never",e.capacity=l);var y=new c(e.capacity,"never"===e.persist),b=!1,O=!1,j=e.interval,k="always"===e.persist?w:y,S=k;return g=g||t.methodFactory,m=function(t,n,i){var c=g(t,n,i),s=v&&e.trace.some(function(e){return e===t});return function(){for(var n=arguments.length,u=Array(n),f=0;f<n;f++)u[f]=arguments[f];var l=e.timestamp(),p=s?a():"";if(p){var h=p.split("\n");h.splice(0,e.depth+3),p=h.join("\n")}k.push([{message:o(u),level:t,logger:i||"",timestamp:l,stacktrace:p}]),r(),c.apply(void 0,u)}},t.methodFactory=m,t.setLevel(t.getLevel()),t},disable:function(){if(!d)throw new Error("You can't disable a not appled plugin");if(m!==d.methodFactory)throw new Error("You can't disable a plugin after appling another plugin");d.methodFactory=g,d.setLevel(d.getLevel()),g=void 0,d=void 0}},w=window?window.remote:void 0;remote.noConflict=function(){return window&&window.remote===remote&&(window.remote=w),remote},e.default=remote,t.exports=e.default});