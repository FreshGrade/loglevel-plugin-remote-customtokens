!function(t,e){if("function"==typeof define&&define.amd)define(["module","exports"],e);else if("undefined"!=typeof exports)e(module,exports);else{var n={exports:{}};e(n,n.exports),t.remote=n.exports}}(this,function(t,e){"use strict";function n(t){try{return JSON.stringify(t)}catch(t){if(!g)try{var e={};e.a=e,JSON.stringify(e)}catch(t){g=t.message}if(t.message===g)return"[Circular]";throw t}}function r(t){if(!Object.getOwnPropertyDescriptor||!Object.getPrototypeOf)return Object.prototype.toString.call(t).slice(8,-1);for(;t;){var e=Object.getOwnPropertyDescriptor(t,"constructor");if(void 0!==e&&"function"==typeof e.value&&""!==e.value.name)return e.value.name;t=Object.getPrototypeOf(t)}return""}function o(t){var e="",o=0;return t.length>1&&"string"==typeof t[0]&&(e=(e=t[0].replace(/(%?)(%([sdjo]))/g,function(e,i,a,s){if(!i){var c=t[o+=1],u="";switch(s){case"s":u+=c;break;case"d":u+=+c;break;case"j":u=n(c);break;case"o":var f=n(c);"{"!==f[0]&&"["!==f[0]&&(f="<"+f+">"),u=r(c)+f}return u}return e})).replace(/%{2,2}/g,"%"),o+=1),t.length>o&&(e&&(e+=" "),e+=t.slice(o).join(" ")),e}function i(){for(var t={},e=0;e<arguments.length;e+=1){var n=Object(arguments[e]);for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]="object"!==l(n[r])||Array.isArray(n[r])?n[r]:i(t[r],n[r]))}return t}function a(){try{throw new Error}catch(t){return t.stack}}function s(t,e){var n=this,r=[],o=[];this.length=function(){return r.length},this.sent=function(){return o.length},this.push=function(n){r.push(n[0]),e&&r.length>t&&r.shift()},this.send=function(){return o.length||(o=r,r=[]),o},this.confirm=function(){o=[],n.content=""},this.fail=function(){var e=1+r.length+o.length-t;e>0&&(o.splice(0,e),r=o.concat(r),n.confirm())}}function c(t,e){var n=this,r=window?window.localStorage:void 0,o={length:function(){return 0},confirm:function(){}};if(!r)return o;var i=void 0,a=void 0,s=void 0;try{i=r.getItem.bind(r),a=r.setItem.bind(r),s=r.removeItem.bind(r);var c=p+"-test";a(c,c),s(c)}catch(t){return o}var u=p+"-queue",f=p+"-sent",l=[],g=[],h=function(n){for(var r=(n=n||l)===l?u:f;;){var o=e?"["+n.join(",")+"]":JSON.stringify(n);if(o.length<512*t)try{a(r,o);break}catch(t){if(!n.length){s(r);break}}n.shift()}},v=i(f);v&&(l=JSON.parse(v),s(f));var d=i(u);d&&(l=l.concat(JSON.parse(d))),l.length&&"string"!=typeof l[0]&&(l=l.map(function(t){return JSON.stringify(t)})),h(),this.length=function(){return l.length},this.sent=function(){return l.sent},this.push=function(t){t.length&&(l=l.concat(t),h())},this.send=function(){return g.length||(g=l,l=[],h(),h(g)),g},this.confirm=function(){g=[],n.content="",s(f)},this.fail=function(){l=g.concat(l),n.confirm(),h()},this.unshift=function(t){t.length&&(l=t.concat(l),h())}}function u(){return{json:!1,formatter:function(t){return"["+t.timestamp+"] "+(t.logger?"("+t.logger+") ":"")+t.level.toUpperCase()+": "+t.message+(t.stacktrace?"\n"+t.stacktrace:"")}}}function f(){throw new Error("You can't set token for a not appled plugin")}Object.defineProperty(e,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p="loglevel-plugin-remote",g=void 0,h=!!a(),v=void 0,d=void 0,m=void 0,y=window?window.remote:void 0,w={url:"/logger",token:"",timeout:0,interval:1e3,backoff:function(t){var e=2*t;return e>3e4&&(e=3e4),e+=.1*e*Math.random()},persist:"never",capacity:0,stacktrace:{levels:["trace","warn","error"],depth:3,excess:0},timestamp:function(){return(new Date).toISOString()},format:u},remote={noConflict:function(){return window&&window.remote===remote&&(window.remote=y),remote},plain:u,json:function(){return{json:!0,formatter:function(t){return delete t.levelVal,t}}},apply:function(t,e){function n(){function t(t){var e=j;t||(j=r.backoff(j),O.fail(),"never"!==r.persist&&k!==p&&(p.push(g.send()),g.confirm(),p.push(g.send()),g.confirm(),k=p)),e?(b=!0,setTimeout(function(){b=!1,n()},e)):n()}if(!b&&!y&&void 0!==r.token){if(!O.sent()){if(p.length())O=p;else{if(!g.length())return;O=g}var e=O.send();O.content=u.json?'{"logs":['+e.join(",")+"]}":e.join("\n")}y=!0;var o=new window.XMLHttpRequest;o.open("POST",r.url,!0),o.setRequestHeader("Content-Type",l),r.token&&o.setRequestHeader("Authorization",f);var i=void 0;r.timeout&&(i=setTimeout(function(){y=!1,o.abort(),t()},r.timeout)),o.onreadystatechange=function(){4===o.readyState&&(y=!1,clearTimeout(i),200===o.status?(j=r.interval,O.confirm(),"always"!==r.persist&&(k=g),t(!0)):(401===o.status&&(r.token=void 0,v.getLogger("logger").error("Authorization Failed")),t()))},o.send(O.content)}}if(!t||!t.getLogger)throw new TypeError("Argument is not a root loglevel object");if(v)throw new Error("You can assign a plugin only one time");if(!window||!window.XMLHttpRequest)return t;v=t;var r=i(w,e),u=r.format(),f="Bearer "+r.token,l=u.json?"application/json":"text/plain";r.capacity||(r.capacity="never"===r.persist?500:50);var p=new c(r.capacity,u.json);p.push||"never"===r.persist||(r.persist="never",r.capacity=500);var g=new s(r.capacity,"never"===r.persist),y=!1,b=!1,j=r.interval,k="always"===r.persist?p:g,O=k;return d=t.methodFactory,m=function(t,e,i){var s=d(t,e,i),c=h&&r.stacktrace.levels.some(function(e){return e===t}),f=v.levels[t.toUpperCase()];return function(){for(var e=arguments.length,l=Array(e),p=0;p<e;p++)l[p]=arguments[p];var g=r.timestamp(),h=c?a():"";if(h){var d=h.split("\n");d.splice(0,r.stacktrace.excess+3);var m=r.stacktrace.depth;m&&d.length!==m+1?(h=d.splice(0,m).join("\n"),d.length&&(h+="\n    and "+d.length+" more")):h=d.join("\n")}var y={message:o(l),level:t,levelVal:f,logger:i||"",timestamp:g,stacktrace:h},w="";if(u.json)try{w+=JSON.stringify(u.formatter(y))}catch(t){return s.apply(void 0,l),void v.getLogger("logger").error(t)}else w+=u.formatter(y);k.push([w]),n(),s.apply(void 0,l)}},t.methodFactory=m,t.setLevel(t.getLevel()),remote.setToken=function(t){r.token=t,f="Bearer "+t,n()},t},disable:function(){if(!v)throw new Error("You can't disable a not appled plugin");if(m!==v.methodFactory)throw new Error("You can't disable a plugin after appling another plugin");v.methodFactory=d,v.setLevel(v.getLevel()),v=void 0,remote.setToken=f},setToken:f};e.default=remote,t.exports=e.default});